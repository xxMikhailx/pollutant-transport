<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<html lang="en">
<div th:replace="~{fragment/head :: head (title=#{index.title})}"></div>
<body>
<div th:replace="~{fragment/nav :: nav (page=#{pages.index})}"></div>

<main class="container">
    <div class="row">
        <div class="col-12 col-sm-12 col-md-12 col-lg-3 col-xl-3 formula-container">
            <form action="#" th:action="@{/simulate}" th:object="${data}" method="POST" class="simulator-form">
                    <th:block th:each="timeConcentrationPair,iterator : ${data.timeConcentrationPairs}">
                        <div class="row time-concentration-pair">
                            <div class="form-group col-5 col-sm-5 col-md-5 col-lg-5 col-xl-5">
                                <label class="time-label" for="time"></label>
                                <input type="text" class="form-control time-input" id="time"
                                       th:value="${timeConcentrationPair.time}">
                            </div>
                            <div class="form-group col-5 col-sm-5 col-md-5 col-lg-5 col-xl-5">
                                <label class="concentration-label" for="concentration"></label>
                                <input type="text" class="form-control concentration-input" id="concentration"
                                       th:value="${timeConcentrationPair.concentration}">
                            </div>
                            <div class=" col-2 col-sm-2 col-md-2 col-lg-2 col-xl-2 d-flex align-items-center" th:if="${iterator.index != 0 && iterator.index != 1}">
                                <a href="#" class="text-danger mt-3 remove-point"><i class="fas fa-minus"></i></a>
                            </div>
                        </div>
                    </th:block>
                <input type="hidden" th:field="*{timeConcentrationPairsJson}" id="timeConcentrationPairsJson">
                <input type="hidden" th:field="*{lat}" id="lat" th:value="${inputData == null} ? 0 : ${inputData.lat}">
                <input type="hidden" th:field="*{lng}" id="lng" th:value="${inputData == null} ? 0 : ${inputData.lng}">
                <div class="form-group text-center">
                    <button type="button" class="btn btn-success add-point" th:text="#{add.point.button.text}"></button>
                </div>
                <div class="form-group text-center">
                    <button type="submit" class="btn btn-primary simulate" th:text="#{simulation.button.text}"></button>
                </div>
            </form>
        </div>
        <div class="col-12 col-sm-12 col-md-12 col-lg-9 col-xl-9 map-container mb-3" id="mainMap">
        </div>
    </div>
</main>

<div th:replace="~{fragment/footer :: footer}"></div>
<div th:replace="~{fragment/script :: script}"></div>
<script th:src="@{/geojson/svisloch.geojson.js}"></script>
<script th:src="@{/js/map.js}"></script>
<script th:inline="javascript">
    /*<![CDATA[*/

    var geoJson = JSON.parse(/*[[${simulatedGeojson}]]*/ 'default');
    var timeTitle = /*[[#{attribute.time}]]*/ 'time'
    var concentrationTitle = /*[[#{attribute.concentration}]]*/ 'time'

    $(".time-label").text(timeTitle);
    $(".concentration-label").text(concentrationTitle);

    L.geoJson(geoJson).addTo(mymap);

    var svislochRiverCoordinates = svislochRiver['features'][0]['geometry']['coordinates'];

    var currentMarker = L.marker([$("#lat").val(), $("#lng").val()]);
    if ($("#lat").val() !== 0 || $("#lng").val() !== 0) {
        currentMarker.addTo(mymap);
    }

    mymap.on('click', onMapClick);
    $(".add-point").on('click', createNewPoint);
    $(".simulator-form").on('click', ".remove-point", removePoint);
    $(".simulate").on('click', generateJson);
    /*]]>*/
</script>
</body>
</html>